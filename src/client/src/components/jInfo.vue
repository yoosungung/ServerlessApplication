<template>
  <v-container grid-list-xs>
    <v-row>
      <v-col
        v-for="itm in objectconfig"
        :key="itm.value"
        cols="12" sm="6" lg="3"
      >
        <v-textarea
          v-if="itm.type == 'textarea'"
          :value="jsondata[itm.value]"
          :label="itm.text"
          rows="1"
          readonly
          dense
          hide-details="true"
        ></v-textarea>
        <v-file-input
          v-else-if="itm.type == 'file'"
          v-model="filedata[itm.value]"
          :label="fileProps(itm)"
          prepend-icon="mdi-paperclip"
          append-outer-icon="mdi-download"
          dense
          hide-details="true"
          @click:append-outer="fileDownload(itm)"
        ></v-file-input>
        <v-select
          v-else-if="itm.type == 'select' || itm.type == 'code'"
          v-model="jsondata[itm.value]"
          :items="itm.code"
          :label="itm.text"
          readonly
          dense
          hide-details="true"
        ></v-select>
        <v-select
          v-else-if="itm.type == 'reference'"
          v-model="jsondata[itm.value]"
          :items="itm.refitems"
          item-value="value"
          item-text="text"
          :label="itm.text"
          readonly
          dense
          hide-details="true"
        ></v-select>
        <v-text-field
          v-else
          :value="jsondata[itm.value]"
          :label="itm.text"
          :type="itm.type"
          readonly
          dense
          hide-details="true"
        ></v-text-field>
      </v-col>
    </v-row>
  </v-container>
</template>

<script>
import s3File from "../utils/s3file.js";

export default {
  props: {
    objectname: String,
    objectconfig: Array,
    objectid: String,
    jsondata: Object
  },
  beforeMount() {
  },
  computed: {
    getTitle() {
      return this.$props.jsondata['title'] || this.$props.jsondata['name'] || this.$props.jsondata['caption'];
    }
  },
  data() {
    return {
      filedata: {},
    }
  },
  methods: {
    fileDownload(item) {
      const s3path = s3File.getPath(this.$props.objectid, item?.value, this.filedata);
      this.$axios
        .get(`/api/file/${s3path}`)
        .then((r) => {
          if (r?.data) {
            fetch(r.data.url)
              .then((response) => console.log("response:", response))
              .catch((error) => console.log("error:", error));
          }
        })
        .catch((e) => {
          console.error(e);
          this.onMessageBox('Erorr', 'File down load error !');
        });
    },
    fileProps(item) {
      s3File.api2file(item?.value, this.filedata, this.$props.jsondata);
      return item?.value;
    }
  }
}
</script>

<style>

</style>